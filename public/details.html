<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Library NoSQL · Reviews &amp; Details</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <nav>
        <div class="brand">
            <div class="brand-title">Library NoSQL</div>
            <div class="brand-tagline">MongoDB-powered community catalog</div>
        </div>

        <div class="nav-section-label">Main</div>
        <div class="nav-links">
            <a href="index.html">
                <span class="icon"></span>
                <span>Dashboard</span>
            </a>
            <a href="catalog.html">
                <span class="icon"></span>
                <span>Book Catalog</span>
            </a>
            <a href="add-book.html">
                <span class="icon"></span>
                <span>Add New Book</span>
            </a>
            <a href="details.html" class="active">
                <span class="icon"></span>
                <span>Reviews &amp; Details</span>
            </a>
            <a href="profile.html">
                <span class="icon"></span>
                <span>User Profile</span>
            </a>
        </div>
    </nav>

    <main>
        <header class="page-header">
            <div class="page-meta">Document details</div>
            <h1>Book reviews &amp; $push demo</h1>
            <p>
                Demonstrates pushing new entries into an array field using MongoDB's
                <strong>$push</strong> operator.
            </p>
        </header>

        <section class="card-grid">
            <article class="card stack-lg">
                <div class="stack">
                    <h2>Target book</h2>
                    <p class="muted-text">
                        Provide a valid <strong>bookId</strong> from your database. In a real app,
                        this would usually come from the URL.
                    </p>
                </div>

                <div class="stack">
                    <label for="bookId">Book ID (MongoDB ObjectId)</label>
                    <input
                        type="text"
                        id="bookId"
                        placeholder="Paste an existing book's _id here"
                    />
                </div>
            </article>

            <article class="card stack-lg">
                <div class="stack">
                    <h2>Add review</h2>
                    <p class="muted-text">
                        Sends a POST request to
                        <span class="pill">/api/books/:id/reviews</span> to append a new review.
                    </p>
                </div>

                <div class="stack">
                    <label for="rating">Rating (1–5)</label>
                    <input
                        type="number"
                        id="rating"
                        placeholder="4"
                        min="1"
                        max="5"
                    />
                </div>

                <div class="stack">
                    <label for="comment">Comment (optional)</label>
                    <textarea
                        id="comment"
                        placeholder="What did you think about this book?"
                    ></textarea>
                </div>

                <div class="stack-row" style="justify-content: flex-end;">
                    <button class="btn btn-primary" type="button" onclick="addReview()">
                        Submit review ($push)
                    </button>
                </div>
            </article>
        </section>
    </main>

    <script>
        async function addReview() {
            const bookIdInput = document.getElementById('bookId');
            const ratingInput = document.getElementById('rating');
            const commentInput = document.getElementById('comment');

            const bookId = bookIdInput.value.trim();
            const rating = Number(ratingInput.value);
            const comment = commentInput.value.trim();

            if (!bookId) {
                alert('Please paste a valid book ID.');
                bookIdInput.focus();
                return;
            }

            if (!rating || rating < 1 || rating > 5) {
                alert('Rating must be between 1 and 5.');
                ratingInput.focus();
                return;
            }

            try {
                await fetch(`http://localhost:3000/api/books/${bookId}/reviews`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ rating, comment }),
                });

                alert('Review submitted via $push!');
                ratingInput.value = '';
                commentInput.value = '';
            } catch (err) {
                console.error(err);
                alert('Failed to submit review. Check that your backend route exists.');
            }
        }
    </script>
</body>
</html>