<!DOCTYPE html>
<html>
<head><title>Library Home</title><link rel="stylesheet" href="style.css"></head>
<body>
    <nav><a href="index.html">Home</a> | <a href="search.html">Tags</a> | <a href="admin.html">Admin</a> | <a href="stats.html">Stats</a></nav>
    <h2>Add to Community Library</h2>
    <input id="t" placeholder="Title"><br>
    <input id="a" placeholder="Author"><br>
    <textarea id="d" placeholder="Book Description"></textarea><br>
    <button onclick="add()">Donate Book</button>
    <hr>
    <div id="list"></div>
    <script>
        async function load() {
            const res = await fetch('/api/books');
            const data = await res.json();
            document.getElementById('list').innerHTML = data.map(b => `
                <div style="border:1px solid #ccc; padding:10px; margin:5px">
                    <h3>${b.title}</h3>
                    <p><i>${b.author}</i></p>
                    <p>${b.description || 'No description.'}</p>
                    <button onclick="exchange('${b._id}')">Exchange (${b.exchangeCount})</button>
                </div>`).join('');
        }
        async function add() {
            await fetch('/api/books', { method: 'POST', headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({ title: t.value, author: a.value, description: d.value })});
            load();
        }
        async function exchange(id) {
            await fetch(`/api/books/${id}/exchange`, { method: 'PATCH' });
            load();
        }
        load();
    </script>
</body>
</html>